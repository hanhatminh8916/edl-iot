# Application name
spring.application.name=BFE_forAIOT

# Server configuration - Heroku sẽ tự động set PORT
server.port=${PORT:8080}

# ========================================
# DATABASE CONFIGURATION
# ========================================

# === OPTION 1: H2 In-Memory (DEVELOPMENT - Backup) ===
# Dùng H2 để develop không cần kết nối internet
# spring.datasource.url=jdbc:h2:mem:testdb
# spring.datasource.driver-class-name=org.h2.Driver
# spring.datasource.username=sa
# spring.datasource.password=
# spring.h2.console.enabled=true
# spring.h2.console.path=/h2-console

# === OPTION 2: Self-hosted MySQL Server (PRIMARY - No query limit!) ===
# Server: 100.96.40.30:3306 (Internal laptop server)
# Database: hatrustsoft
# (Commented - use application-heroku.properties instead on Heroku)
# spring.datasource.url=jdbc:mysql://100.96.40.30:3306/hatrustsoft?useSSL=false&serverTimezone=Asia/Ho_Chi_Minh&allowPublicKeyRetrieval=true&autoReconnect=true
# spring.datasource.username=remote_user
# spring.datasource.password=MatKhauManh123! 
# spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# spring.datasource.url=jdbc:mysql://localhost:3306/hatrustsoft?useSSL=false&serverTimezone=Asia/Ho_Chi_Minh&allowPublicKeyRetrieval=true&autoReconnect=true
# spring.datasource.username=remote_user
# spring.datasource.password=MatKhauManh123! 
# spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# === BACKUP: JawsDB MySQL Cloud (FALLBACK if self-hosted down) ===
# Uncomment these lines if need to switch back to JawsDB
# spring.datasource.url=jdbc:mysql://tk3mehkfmmrhjg0b.cbetxkdyhwsb.us-east-1.rds.amazonaws.com:3306/bsrxqa8k23608y3y?useSSL=true&requireSSL=false&serverTimezone=Asia/Ho_Chi_Minh&allowPublicKeyRetrieval=true&autoReconnect=true
# spring.datasource.username=i299o9m20iz3rx3f
# spring.datasource.password=ebxs5nknkrgk349h

# Connection Pool Settings - Increased for self-hosted server (no query limit!)
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# Graceful Shutdown
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=20s

# JPA/Hibernate
# Chuyển sang 'update' để giữ dữ liệu khi restart (thay vì 'create-drop')
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Disable SQL script initialization (schema.sql, data.sql)
spring.sql.init.mode=never

# ========================================
# MQTT CONFIGURATION - HiveMQ Cloud
# ========================================
mqtt.broker.url=ssl://d0a82f39864c4e86a0551feaed97f7c5.s1.eu.hivemq.cloud:8883
mqtt.client.id=bfe-backend-${random.value}
mqtt.username=truong123
mqtt.password=Truong123
mqtt.topic=helmet/#

# WebSocket
spring.websocket.allowed-origins=*

# ========================================
# REDIS CONFIGURATION
# ========================================
# Local Redis (Development) - Uncomment khi chạy local
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=60000
spring.data.redis.ssl.enabled=${REDIS_SSL:false}


# ========================================
# FACEBOOK MESSENGER CONFIGURATION
# ========================================
# Lấy từ Facebook Developer Console
facebook.messenger.page-access-token=EAATEoWNyyykBPZBODwZC9ZBoWSTvYWztK42WOeTmpCR4WfqQ16ZC1b5K4LtyKmLmqsRlH8BQEHMEFb8HMT5ZBMqBImZBda3BZA53GDZBfe0nu9zuZC3CkL9iEPLl9npAvDPMWzXS4hKHqNGyZBsp8yDBSVUpYcmGKZAMT7EgjrhtsWflMLnUgym5ZA6ZANgvofmTZB8U0ZAgOAw0fZCNwsrjzq1eq6ucHwZDZD
facebook.messenger.verify-token=BFE_SECURE_VERIFY_TOKEN_2025
facebook.messenger.api-url=https://graph.facebook.com/v18.0/me/messages

# ========================================
# LLM ANALYTICS API CONFIGURATION
# ========================================
# Safety Analytics LLM API for AI-powered data analysis
# DEV: Using VS Code DevTunnel (no auth required)
llm.api.base-url=${LLM_API_BASE_URL:https://sd7zcbc8-8000.asse.devtunnels.ms}
llm.api.key=${LLM_API_KEY:}
# Giảm timeout xuống 15s để tránh Heroku H12 timeout (30s limit)
llm.api.timeout=15

# Logging
logging.level.com.hatrustsoft.bfe_foraiot=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=DEBUG

# ========================================
# WEB PUSH NOTIFICATION (VAPID)
# ========================================
# VAPID keys cho Web Push API - để thông báo khi màn hình khóa (iPhone, Android)
webpush.vapid.public-key=BJx7_5ERaNMyFe9OIPU5ON8NVqfPaZ4_SnDFWknOOM-PI4N3-0-pkfdmBzg0epOVbi75oYRK5nC5-7ZS0-DAFg0
webpush.vapid.private-key=V1RmDdrNZDgOtkO1v7XNAgNnhETEwTUXl8Z161vzwBk
webpush.vapid.subject=mailto:admin@edl-safework.com
