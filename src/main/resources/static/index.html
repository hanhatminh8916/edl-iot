<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EDL SafeWork - H·ªá th·ªëng gi√°m s√°t c√¥ng tr∆∞·ªùng</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SafeWork">
    <meta name="description" content="H·ªá th·ªëng gi√°m s√°t v·ªã tr√≠ v√† an to√†n c√¥ng nh√¢n t·∫°i c√¥ng tr∆∞·ªùng">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="/images/icon.svg">
    <link rel="apple-touch-icon" href="/images/icon-192.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <i class="fas fa-hard-hat"></i>
            <h1>EDL SafeWork</h1>
        </div>
        <div class="header-center">
            <h2>H·ªá th·ªëng gi√°m s√°t c√¥ng tr∆∞·ªùng</h2>
        </div>
        <div class="header-right">
            <div class="notification-icon">
                <i class="fas fa-bell"></i>
                <span class="badge">3</span>
            </div>
            <div class="admin-profile">
                <i class="fas fa-user-circle"></i>
                <span>Admin</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="nav-menu">
                <a href="index.html" class="nav-item active">
                    <i class="fas fa-chart-line"></i>
                    <span>T·ªïng quan</span>
                </a>
                <a href="location.html" class="nav-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Gi√°m s√°t v·ªã tr√≠</span>
                </a>
                <a href="positioning-2d.html" class="nav-item">
                    <i class="fas fa-ruler-combined"></i>
                    <span>S∆° ƒê·ªì 2D</span>
                </a>
                <a href="employees.html" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Qu·∫£n l√Ω c√¥ng nh√¢n</span>
                </a>
                <a href="manage-helmets.html" class="nav-item">
                    <i class="fas fa-hard-hat"></i>
                    <span>Qu·∫£n l√Ω m≈©</span>
                </a>
                <!-- <a href="location.html" class="nav-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>C·∫£nh b√°o</span>
                </a> -->
                <a href="reports.html" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>B√°o c√°o</span>
                </a>
                <a href="ai-analytics.html" class="nav-item">
                    <i class="fas fa-robot"></i>
                    <span>AI Analytics</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>C√†i ƒë·∫∑t</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1>T·ªïng quan h·ªá th·ªëng</h1>
                    <p>Gi√°m s√°t t√¨nh tr·∫°ng c√¥ng nh√¢n v√† an to√†n c√¥ng tr∆∞·ªùng</p>
                </div>
                <button class="btn-export">
                    <i class="fas fa-download"></i>
                    Xem tr·ª±c ti·∫øp
                </button>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-info">
                        <h3>T·ªïng c√¥ng nh√¢n</h3>
                        <div class="stat-value" id="stat-total-workers">--</div>
                        <p class="stat-label">ƒê√£ ƒëƒÉng k√Ω</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-info">
                        <h3>ƒêang l√†m vi·ªác</h3>
                        <div class="stat-value" id="stat-active-workers">--</div>
                        <p class="stat-label">Online trong 30s</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon warning">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <h3>C·∫£nh b√°o h√¥m nay</h3>
                        <div class="stat-value warning-text" id="stat-alerts">--</div>
                        <p class="stat-label">S·ª± c·ªë ghi nh·∫≠n</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon success">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Hi·ªáu su·∫•t</h3>
                        <div class="stat-value success-text" id="stat-efficiency">--%</div>
                        <p class="stat-label">T·ª∑ l·ªá ho·∫°t ƒë·ªông</p>
                    </div>
                </div>
            </div>

            <!-- Two Column Layout -->
            <div class="two-column-layout">
                <!-- Urgent Alerts -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-exclamation-triangle warning-text"></i>
                            <h3>C·∫£nh b√°o g·∫ßn ƒë√¢y</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="card-subtitle">C√°c s·ª± c·ªë v√† c·∫£nh b√°o trong ng√†y h√¥m nay</p>
                        
                        <div class="alert-list" id="recent-alerts-list">
                            <div style="text-align: center; padding: 20px; color: #6b7280;">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>ƒêang t·∫£i...</p>
                            </div>
                        </div>

                        <button class="btn-link" onclick="window.location.href='alerts.html'">Xem t·∫•t c·∫£ c·∫£nh b√°o</button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-bolt"></i>
                            <h3>Thao t√°c nhanh</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <p class="card-subtitle">C√°c ch·ª©c nƒÉng th∆∞·ªùng d√πng trong qu·∫£n l√Ω</p>
                        
                        <div class="action-list">
                            <div class="action-item">
                                <i class="fas fa-search"></i>
                                <div class="action-content">
                                    <h4>Xem b·∫£n ƒë·ªì tr·ª±c ti·∫øp</h4>
                                    <p>Theo d√µi v·ªã tr√≠ c√¥ng nh√¢n</p>
                                </div>
                            </div>

                            <div class="action-item">
                                <i class="fas fa-user-plus"></i>
                                <div class="action-content">
                                    <h4>Th√™m c√¥ng nh√¢n m·ªõi</h4>
                                    <p>ƒêƒÉng k√Ω v√† g√°n thi·∫øt b·ªã</p>
                                </div>
                            </div>

                            <div class="action-item">
                                <i class="fas fa-file-alt"></i>
                                <div class="action-content">
                                    <h4>B√°o c√°o v√† t·ªïm vi·ªác</h4>
                                    <p>Th·ªëng k√™ theo giai ƒëo·∫°n l√†m vi·ªác</p>
                                </div>
                            </div>

                            <div class="action-item" onclick="window.location.href='ai-analytics.html'" style="cursor: pointer;">
                                <i class="fas fa-robot"></i>
                                <div class="action-content">
                                    <h4>ü§ñ AI Analytics</h4>
                                    <p>H·ªèi AI v·ªÅ d·ªØ li·ªáu an to√†n</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Critical Warnings & Battery Status Section -->
            <div class="critical-section">
                <!-- Critical Warnings -->
                <div class="card critical-warnings-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-exclamation-circle" style="color: #ef4444;"></i>
                            <h3>C·∫£nh b√°o nguy hi·ªÉm</h3>
                        </div>
                        <span class="critical-badge" id="critical-count">0 c·∫£nh b√°o</span>
                    </div>
                    <div class="card-body">
                        <p class="card-subtitle">C√¥ng nh√¢n c·∫ßn h·ªó tr·ª£ kh·∫©n c·∫•p</p>
                        
                        <div class="critical-list" id="critical-alerts-list">
                            <div style="text-align: center; padding: 30px; color: #6b7280;">
                                <i class="fas fa-check-circle" style="font-size: 24px; color: #22c55e;"></i>
                                <p style="margin-top: 10px;">Kh√¥ng c√≥ c·∫£nh b√°o nguy hi·ªÉm</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Battery Status -->
                <div class="card battery-status-card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-battery-half" style="color: #f59e0b;"></i>
                            <h3>Tr·∫°ng th√°i pin m≈© b·∫£o h·ªô</h3>
                        </div>
                        <span class="battery-count" id="battery-device-count">0 thi·∫øt b·ªã</span>
                    </div>
                    <div class="card-body">
                        <p class="card-subtitle">Gi√°m s√°t pin qua module INA219 DC</p>
                        
                        <div class="battery-list" id="battery-status-list">
                            <div style="text-align: center; padding: 30px; color: #6b7280;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                                <p style="margin-top: 10px;">ƒêang t·∫£i...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                </div>
            </div>

            <!-- AI Daily Insights Section -->
            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <div class="card-title">
                        <i class="fas fa-robot" style="color: #667eea;"></i>
                        <h3>ü§ñ AI Insights - H√¥m nay</h3>
                    </div>
                    <button class="btn-link" onclick="refreshAIInsights()">
                        <i class="fas fa-sync-alt"></i> L√†m m·ªõi
                    </button>
                </div>
                <div class="card-body">
                    <p class="card-subtitle">Ph√¢n t√≠ch t·ª± ƒë·ªông t·ª´ AI v·ªÅ t√¨nh h√¨nh an to√†n</p>
                    <div id="ai-insights-container" style="min-height: 100px;">
                        <div style="text-align: center; padding: 30px; color: #6b7280;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                            <p style="margin-top: 10px;">ƒêang t·∫£i insights...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script src="js/vietnam-time.js"></script>
    <script src="js/vietnam-time.js"></script>
    <script src="js/global-alerts.js"></script>
    <script src="js/llm-analytics.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/script.js"></script>
    
    <!-- AI Insights Integration -->
    <script>
        // Auto-load AI insights on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadDailyAIInsights, 1000);
        });

        async function loadDailyAIInsights() {
            const container = document.getElementById('ai-insights-container');
            
            try {
                const response = await fetch('/api/analytics/insights', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        timeRange: '1d',
                        insightTypes: ['trends', 'anomalies']
                    })
                });

                if (!response.ok) throw new Error('API error');
                
                const data = await response.json();
                displayDailyInsights(data);
            } catch (error) {
                console.error('Failed to load AI insights:', error);
                container.innerHTML = `
                    <div style="background: #fef3c7; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <p style="margin: 0;">‚ö†Ô∏è Kh√¥ng th·ªÉ t·∫£i AI insights. <a href="ai-analytics.html" style="color: #667eea;">Xem chi ti·∫øt t·∫°i ƒë√¢y</a></p>
                    </div>
                `;
            }
        }

        function displayDailyInsights(data) {
            const container = document.getElementById('ai-insights-container');
            
            let html = '';
            
            // Summary
            if (data.summary) {
                html += `
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #22c55e;">
                        <strong>üìä T·ªïng quan:</strong>
                        <p style="margin: 5px 0 0 0;">${data.summary}</p>
                    </div>
                `;
            }
            
            // Insights
            if (data.insights && data.insights.length > 0) {
                html += '<div style="background: #eff6ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #3b82f6;">';
                html += '<strong style="color: #1e40af;">üí° Key Insights:</strong>';
                html += '<ul style="margin: 10px 0 0 20px; padding: 0;">';
                data.insights.slice(0, 3).forEach(insight => {
                    html += `<li style="margin-bottom: 8px;">${insight}</li>`;
                });
                html += '</ul></div>';
            }
            
            // Recommendations
            if (data.recommendations && data.recommendations.length > 0) {
                const highPriority = data.recommendations.filter(r => r.priority === 'HIGH').slice(0, 2);
                if (highPriority.length > 0) {
                    html += '<div style="background: #fee2e2; padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444;">';
                    html += '<strong style="color: #991b1b;">üéØ H√†nh ƒë·ªông ∆∞u ti√™n:</strong>';
                    highPriority.forEach(rec => {
                        html += `
                            <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 6px;">
                                <strong>${rec.action}</strong>
                                <p style="margin: 5px 0 0 0; font-size: 14px; color: #6b7280;">${rec.impact}</p>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
            }
            
            // Link to full AI Analytics
            html += `
                <div style="text-align: center; margin-top: 15px;">
                    <a href="ai-analytics.html" style="color: #667eea; text-decoration: none; font-weight: 600;">
                        <i class="fas fa-arrow-right"></i> Xem th√™m ph√¢n t√≠ch AI
                    </a>
                </div>
            `;
            
            container.innerHTML = html;
        }

function refreshAIInsights() {
            const container = document.getElementById('ai-insights-container');
            container.innerHTML = `
                <div style="text-align: center; padding: 30px; color: #6b7280;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                    <p style="margin-top: 10px;">ƒêang l√†m m·ªõi...</p>
                </div>
            `;
            loadDailyAIInsights();
        }
    </script>
    
    <!-- Mobile Navigation & PWA -->
    <script src="js/mobile-nav.js"></script>
    <script src="js/pwa-init.js"></script>
    
    <!-- Voice Assistant -->
    <script src="js/voice-assistant.js?v=360ui"></script>
</body>
</html>