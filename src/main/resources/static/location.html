<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>EDL SafeWork - Gi√°m s√°t v·ªã tr√≠ th·ªùi gian th·ª±c (v183)</title>
    <link rel="stylesheet" href="css/style.css?v=183">
    <link rel="stylesheet" href="css/location.css?v=183">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <i class="fas fa-hard-hat"></i>
            <h1>EDL SafeWork</h1>
        </div>
        <div class="header-center">
            <h2>H·ªá th·ªëng gi√°m s√°t v·ªã tr√≠ c√¥ng tr∆∞·ªùng</h2>
        </div>
        <div class="header-right">
            <div class="notification-icon">
                <i class="fas fa-bell"></i>
                <span class="badge">3</span>
            </div>
            <div class="admin-profile">
                <i class="fas fa-user-circle"></i>
                <span>Admin</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <nav class="nav-menu">
                <a href="index.html" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>T·ªïng quan</span>
                </a>
                <a href="location.html" class="nav-item active">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Gi√°m s√°t v·ªã tr√≠</span>
                </a>
                <a href="positioning-2d.html" class="nav-item">
                    <i class="fas fa-ruler-combined"></i>
                    <span>S∆° ƒê·ªì 2D</span>
                </a>
                <a href="employees.html" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Qu·∫£n l√Ω c√¥ng nh√¢n</span>
                </a>
                <a href="location.html" class="nav-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>C·∫£nh b√°o</span>
                </a>
                <a href="reports.html" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>B√°o c√°o</span>
                </a>
                <a href="ai-analytics.html" class="nav-item">
                    <i class="fas fa-robot"></i>
                    <span>AI Analytics</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>C√†i ƒë·∫∑t</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content location-page">
            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1>Gi√°m s√°t v·ªã tr√≠ th·ªùi gian th·ª±c</h1>
                    <p>Theo d√µi v·ªã tr√≠ v√† tr·∫°ng th√°i c·ªßa t·∫•t c·∫£ c√¥ng nh√¢n tr√™n c√¥ng tr∆∞·ªùng</p>
                </div>
            </div>

            <!-- Status Cards -->
            <div class="status-cards">
                <div class="status-card">
                    <div class="status-icon green">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="status-info">
                        <div class="status-label">T·ªïng s·ªë</div>
                        <div class="status-value" id="stat-total">0</div>
                    </div>
                </div>

                <div class="status-card">
                    <div class="status-icon blue">
                        <i class="fas fa-broadcast-tower"></i>
                    </div>
                    <div class="status-info">
                        <div class="status-label">An to√†n</div>
                        <div class="status-value" id="stat-safe">0</div>
                    </div>
                </div>

                <div class="status-card">
                    <div class="status-icon orange">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="status-info">
                        <div class="status-label">C·∫£nh b√°o</div>
                        <div class="status-value" id="stat-warning">0</div>
                    </div>
                </div>

                <div class="status-card">
                    <div class="status-icon red">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="status-info">
                        <div class="status-label">Nguy hi·ªÉm</div>
                        <div class="status-value" id="stat-danger">0</div>
                    </div>
                </div>

                <div class="status-card">
                    <div class="status-icon gray">
                        <i class="fas fa-signal"></i>
                    </div>
                    <div class="status-info">
                        <div class="status-label">M·∫•t t√≠n hi·ªáu</div>
                        <div class="status-value" id="stat-offline">0</div>
                    </div>
                </div>
            </div>

            <!-- Map and Workers Layout -->
            <div class="map-layout">
                <!-- Map Section -->
                <div class="map-section">
                    <div class="card map-card">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-map"></i>
                                <h3>B·∫£n ƒë·ªì c√¥ng tr∆∞·ªùng</h3>
                            </div>
                            <button class="btn-expand">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                        <div class="card-body map-body">
                            <p class="map-subtitle">C·∫≠p nh·∫≠t v·ªã tr√≠ m·ªõi nh·∫•t: <span id="lastUpdate">--</span></p>
                            
                            <!-- Alert Box - Geo-Fence -->
                            <div id="alertBox" style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); padding: 10px 20px; background-color: #ff4444; color: white; border-radius: 8px; font-weight: bold; display: none; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                                üö® Nh√¢n vi√™n ra kh·ªèi khu v·ª±c an to√†n!
                            </div>
                            
                            <!-- Hint Box -->
                            <div id="hint" style="position: absolute; top: 10px; right: 10px; background-color: white; padding: 8px 12px; border-radius: 8px; font-size: 14px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); z-index: 999;">
                                üñ±Ô∏è <span style="color: #667eea;">‚ñ¢</span> V·∫Ω v√πng | <span style="color: #FFA500;">‚óº</span> Chuy·ªÉn ch·∫ø ƒë·ªô | üñ±Ô∏è Double-click khu v·ª±c v√†ng ‚Üí Xem 2D
                            </div>
                            
                            <div id="map" class="map-container">
                                <!-- B·∫£n ƒë·ªì Leaflet s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                            </div>
                            <div class="map-legend">
                                <div class="legend-item">
                                    <span class="legend-marker" style="background-color: #10b981; width: 16px; height: 16px; border-radius: 50%; display: inline-block; border: 2px solid white;"></span>
                                    <span>An to√†n</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-marker" style="background-color: #f97316; width: 16px; height: 16px; border-radius: 50%; display: inline-block; border: 2px solid white;"></span>
                                    <span>C·∫£nh b√°o</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-marker" style="background-color: #ef4444; width: 16px; height: 16px; border-radius: 50%; display: inline-block; border: 2px solid white;"></span>
                                    <span>Ngo√†i v√≤ng</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-marker" style="background-color: #6b7280; width: 16px; height: 16px; border-radius: 50%; display: inline-block; border: 2px solid white;"></span>
                                    <span>Offline</span>
                                </div>
                            </div>
                            <button class="btn-show-more">
                                <i class="fas fa-chevron-down"></i>
                                ƒê√≥ng b·∫£ng b√™n
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Workers List Section -->
                <div class="workers-section">
                    <div class="card workers-card">
                        <div class="card-header">
                            <div class="card-title">
                                <i class="fas fa-users"></i>
                                <h3>Danh s√°ch c√¥ng nh√¢n</h3>
                            </div>
                        </div>
                        <div class="card-body workers-body">
                            <p class="card-subtitle">Theo d√µi v·ªã tr√≠ v√† tr·∫°ng th√°i</p>
                            
                            <!-- Worker List - S·∫º ƒê∆Ø·ª¢C LOAD T·ª™ API -->
                            <div class="worker-list" id="workers-list">
                                <!-- Loading placeholder -->
                                <div class="worker-item" style="justify-content: center; color: #888;">
                                    <i class="fas fa-spinner fa-spin"></i>&nbsp; ƒêang t·∫£i d·ªØ li·ªáu...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Map Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <!-- WebSocket Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script src="js/global-alerts.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/location.js?v=188"></script>
</body>
</html>